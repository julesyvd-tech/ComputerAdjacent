<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Compost Adjacent</title>
<meta name="description" content="Compost Adjacent — cosmic compost transmissions" />

<!-- Pink glowing worm favicon -->
<link rel="icon" href="data:image/svg+xml;utf8,
%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 64 64'%3E%3Cdefs%3E%3Cfilter id='g'%3E%3CfeGaussianBlur stdDeviation='2.8'/%3E%3C/filter%3E%3C/defs%3E%3Crect width='100%25' height='100%25' fill='%23060606'/%3E%3Cpath d='M8 36c4-10 12-12 20-10s14 8 20 12 8 6 12 4' stroke='%23ff4fb3' stroke-width='4' stroke-linecap='round' fill='none' filter='url(%23g)'/%3E%3C/svg%3E">

<style>
  :root{
    --worm1:#ff4fb3; --worm2:#80ffb0; --worm3:#ffd24a;
    --worm4:#ff8a3d; --worm5:#50f1ff; --worm6:#ff5b5b;
    --bg:#030303;
  }
  html,body{
    height:100%;margin:0;background:var(--bg);
    font-family:Verdana,Arial,sans-serif;color:#dfeee0;
    overflow:hidden;-webkit-font-smoothing:antialiased;
  }
  /* Dither overlay behind stars now */
  body::before{
    content:"";position:fixed;inset:0;z-index:0;pointer-events:none;
    background-image:url("data:image/svg+xml;utf8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='32' height='32'%3E%3Crect width='100%25' height='100%25' fill='%23020202'/%3E%3Cfilter id='n'%3E%3CfeTurbulence baseFrequency='0.9' numOctaves='2' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)' opacity='0.07'/%3E%3C/svg%3E");
    background-repeat:repeat;mix-blend-mode:overlay;opacity:.9;
  }
  canvas#stars{position:fixed;inset:0;z-index:3;display:block;width:100%;height:100%}
  .worm-layer{position:fixed;inset:0;z-index:2;pointer-events:none}
  .wrap{position:relative;z-index:4;min-height:100vh;
    display:flex;flex-direction:column;align-items:center;justify-content:center;gap:14px;padding-top:2vh;}
  .title-vertical{display:flex;flex-direction:column;align-items:center;gap:2px;z-index:6;user-select:none;}
  .title-vertical .letter{
    display:block;font-size:clamp(28px,6.5vw,64px);
    font-weight:800;line-height:0.9;text-transform:uppercase;
    transform-origin:50% 50%;text-shadow:0 10px 24px rgba(0,0,0,.6);
  }
  @keyframes letterFloat{
    0%{transform:translateY(0)}
    25%{transform:translateY(-10%)}
    50%{transform:translateY(0)}
    75%{transform:translateY(6%)}
    100%{transform:translateY(0)}
  }
  .links-left,.links-right{position:fixed;bottom:22px;z-index:7;display:flex;gap:14px;align-items:center}
  .links-left{left:18px}.links-right{right:18px}
  .link-btn{width:72px;height:72px;display:grid;place-items:center;
    border-radius:12px;text-decoration:none;
    border:2px solid rgba(255,255,255,0.03);
    background:linear-gradient(180deg,rgba(255,255,255,0.02),rgba(0,0,0,0.12));
    box-shadow:0 8px 28px rgba(0,0,0,.55);
  }
  .link-btn svg{width:48px;height:28px}
  .player-box{position:fixed;left:18px;top:18px;z-index:9;width:260px;height:84px;
    border-radius:10px;background:linear-gradient(180deg,rgba(0,0,0,.55),rgba(0,0,0,.35));
    border:2px solid rgba(255,255,255,.04);
    box-shadow:0 18px 44px rgba(0,0,0,.6),0 0 28px rgba(255,255,255,.03);
    display:flex;align-items:center;gap:8px;padding:8px;cursor:grab;touch-action:none;
  }
  .player-box:active{cursor:grabbing}
  .player-inner{flex:1;height:100%;border-radius:8px;overflow:hidden}
  .player-handle{width:34px;height:34px;border-radius:6px;display:flex;
    align-items:center;justify-content:center;margin-left:6px;margin-right:4px;
    background:linear-gradient(180deg,rgba(255,255,255,.03),rgba(0,0,0,.12));
    border:1px solid rgba(255,255,255,.03);color:#fff;font-size:12px;font-weight:700;
    box-shadow:0 6px 18px rgba(0,0,0,.6);
  }
  .unmute-hint{position:fixed;left:50%;transform:translateX(-50%);
    bottom:110px;z-index:9;font-family:monospace;font-size:12px;
    color:rgba(220,240,200,.88);padding:6px 10px;border-radius:6px;
    background:rgba(0,0,0,.28);border:1px solid rgba(255,255,255,.03);
    opacity:0;transition:opacity .3s;
  }
  .inverted{filter:invert(1) hue-rotate(180deg)}
  .inverted .player-box{filter:none}
  @media(max-width:520px){
    .link-btn{width:56px;height:56px}
    .link-btn svg{width:40px;height:22px}
    .player-box{width:220px;height:72px;left:12px;top:12px}
    .title-vertical .letter{font-size:clamp(20px,8vw,36px)}
  }
</style>
</head>
<body>
  <canvas id="stars" aria-hidden="true"></canvas>
  <div class="worm-layer" id="wormLayer" aria-hidden="true"></div>

  <div class="wrap" role="main" aria-labelledby="siteTitle">
    <div class="title-vertical" id="siteTitle" aria-label="COMPOST ADJACENT" role="heading" aria-level="1"></div>
  </div>

  <div class="links-left">
    <a class="link-btn" href="https://open.spotify.com/artist/4JYHgAnjpihRXtvZ8Qssok" target="_blank" aria-label="Spotify">
      <svg viewBox="0 0 200 40" xmlns="http://www.w3.org/2000/svg"><path d="M5,20 Q25,10 45,20 T85,20 T125,20 T165,20 T195,20" fill="none" stroke="var(--worm2)" stroke-width="7" stroke-linecap="round" stroke-linejoin="round"/></svg>
    </a>
  </div>

  <div class="links-right">
    <a class="link-btn" href="https://www.instagram.com/compostadjacent/" target="_blank" aria-label="Instagram">
      <svg viewBox="0 0 200 40" xmlns="http://www.w3.org/2000/svg"><path d="M5,20 Q25,10 45,20 T85,20 T125,20 T165,20 T195,20" fill="none" stroke="var(--worm4)" stroke-width="7" stroke-linecap="round" stroke-linejoin="round"/></svg>
    </a>
    <a class="link-btn" href="https://www.instagram.com/compostadjacent/" target="_blank" aria-label="Contact">
      <svg viewBox="0 0 200 40" xmlns="http://www.w3.org/2000/svg"><path d="M5,20 Q25,10 45,20 T85,20 T125,20 T165,20 T195,20" fill="none" stroke="var(--worm1)" stroke-width="7" stroke-linecap="round" stroke-linejoin="round"/></svg>
    </a>
  </div>

  <div class="player-box" id="playerBox">
    <div class="player-handle" id="playerHandle">≡</div>
    <div class="player-inner">
      <iframe id="spotifyFrame"
        src="https://open.spotify.com/embed/artist/4JYHgAnjpihRXtvZ8Qssok?utm_source=generator&theme=0"
        width="100%" height="80" frameborder="0"
        allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture"
        loading="lazy" title="Compost Adjacent Spotify player"></iframe>
    </div>
  </div>

  <div class="unmute-hint" id="unmuteHint">Click the player to unmute / open in Spotify for full playback</div>
  <script>
  // ==== INITIAL SETUP ====
  const titleEl = document.getElementById("siteTitle");
  const letters = "COMPOST ADJACENT".split("");
  const wormColors = ['var(--worm1)','var(--worm2)','var(--worm3)','var(--worm4)','var(--worm5)','var(--worm6)'];
  letters.forEach((l, i) => {
    const span = document.createElement("span");
    span.textContent = l;
    span.className = "letter";
    span.style.color = wormColors[i % wormColors.length];
    span.style.animation = `letterFloat 3s ease-in-out ${i * 0.15}s infinite`;
    titleEl.appendChild(span);
  });

  // ==== STARFIELD (CRT GLOW) ====
  const canvas = document.getElementById("stars");
  const ctx = canvas.getContext("2d");
  let w, h, stars = [];
  function resize(){
    w = canvas.width = window.innerWidth;
    h = canvas.height = window.innerHeight;
  }
  window.addEventListener("resize", resize);
  resize();
  function random(min,max){return Math.random()*(max-min)+min;}
  function createStars(){
    stars = [];
    for(let i=0;i<260;i++){
      stars.push({
        x:random(0,w),
        y:random(0,h),
        r:Math.random()*1.1+0.3,
        c:wormColors[Math.floor(Math.random()*wormColors.length)],
        a:Math.random()
      });
    }
  }
  createStars();

  function drawStars(){
    ctx.clearRect(0,0,w,h);
    stars.forEach(s=>{
      ctx.beginPath();
      let glow = 0.6 + Math.sin(Date.now()/800 + s.a)*0.4;
      ctx.globalAlpha = glow;
      ctx.shadowBlur = 6;
      ctx.shadowColor = s.c;
      ctx.fillStyle = s.c;
      ctx.arc(s.x,s.y,s.r,0,Math.PI*2);
      ctx.fill();
    });
    requestAnimationFrame(drawStars);
  }
  drawStars();

  // ==== WORMS ====
  const wormLayer = document.getElementById("wormLayer");

  // worm placement fix + smaller worms + dynamic constellation
  let wormCount = 120;
  function createWorms(){
    wormLayer.innerHTML = "";
    const used = [];
    for(let i=0;i<wormCount;i++){
      const worm = document.createElementNS("http://www.w3.org/2000/svg","svg");
      worm.setAttribute("viewBox","0 0 200 40");
      const color = wormColors[i % wormColors.length];
      worm.innerHTML = `<path d="M5,20 Q25,10 45,20 T85,20 T125,20 T165,20 T195,20" fill="none" stroke="${color}" stroke-width="4" stroke-linecap="round" stroke-linejoin="round"/>`;
      worm.style.position="absolute";
      worm.style.width="22px";
      worm.style.height="10px";

      // random placement (no clustering)
      let x,y,tries=0;
      do{
        x = Math.random()*(window.innerWidth - 60);
        y = Math.random()*(window.innerHeight - 30);
        tries++;
      }while(used.some(u=>Math.abs(u.x-x)<50 && Math.abs(u.y-y)<20) && tries<100);
      used.push({x,y});
      worm.style.left = x+"px";
      worm.style.top = y+"px";
      worm.style.opacity = 0.85+Math.random()*0.15;
      worm.style.filter = `drop-shadow(0 0 4px ${color})`;
      worm.style.transition = "transform 3s ease-in-out";
      wormLayer.appendChild(worm);
    }
  }

  // reseed after load
  window.addEventListener("load",()=>{ setTimeout(createWorms,400); });

  // subtle wriggle motion
  setInterval(()=>{
    const worms = document.querySelectorAll(".worm-layer svg");
    worms.forEach(w=>{
      const dx = (Math.random()-0.5)*3;
      const dy = (Math.random()-0.5)*3;
      w.style.transform = `translate(${dx}px,${dy}px)`;
    });
  },2400);

  // ==== SHOOTING STARS + EXPLOSIONS ====
  let shootCount=0;
  function shootingStar(){
    if(document.hidden) return;
    shootCount++;
    const sx = Math.random()<0.5 ? 0 : w;
    const sy = random(0,h);
    const angle = random(-Math.PI/3,Math.PI/3);
    const spd = random(4,8);
    let x=sx, y=sy;
    const trail = [];
    const c = wormColors[Math.floor(Math.random()*wormColors.length)];
    const timer=setInterval(()=>{
      x += Math.cos(angle)*spd*(sx===0?1:-1);
      y += Math.sin(angle)*spd;
      trail.push({x,y,life:1});
      trail.forEach(t=>t.life-=0.05);
      ctx.save();
      ctx.globalCompositeOperation="lighter";
      trail.forEach(t=>{
        ctx.beginPath();
        ctx.strokeStyle=c;
        ctx.globalAlpha=t.life*0.8;
        ctx.moveTo(t.x,t.y);
        ctx.lineTo(t.x-8,t.y-8);
        ctx.stroke();
      });
      ctx.restore();
      if(x<0||x>w||y<0||y>h){clearInterval(timer);}
    },30);

    if(shootCount%5===0){setTimeout(explosion,random(2000,3000));}
  }

  function explosion(){
    if(document.hidden) return;
    const ex=w/2+random(-w*0.15,w*0.15);
    const ey=h/2+random(-h*0.15,h*0.15);
    const parts=[];
    for(let i=0;i<40;i++){
      parts.push({
        x:ex,y:ey,
        vx:Math.cos(i*Math.PI/20)*random(1,5),
        vy:Math.sin(i*Math.PI/20)*random(1,5),
        life:1,
        c:wormColors[Math.floor(Math.random()*wormColors.length)]
      });
    }
    const t=setInterval(()=>{
      ctx.save();
      ctx.globalCompositeOperation="lighter";
      parts.forEach(p=>{
        p.x+=p.vx;p.y+=p.vy;p.life-=0.03;
        ctx.beginPath();
        ctx.fillStyle=p.c;
        ctx.globalAlpha=p.life;
        ctx.arc(p.x,p.y,2,0,Math.PI*2);
        ctx.fill();
      });
      ctx.restore();
      if(parts.every(p=>p.life<=0)){clearInterval(t);}
    },30);
  }

  setInterval(shootingStar,90000);

  // ==== PLAYER DRAG ====
  const playerBox=document.getElementById("playerBox");
  const handle=document.getElementById("playerHandle");
  let offX,offY,drag=false;
  handle.addEventListener("pointerdown",e=>{
    drag=true;offX=e.clientX-playerBox.offsetLeft;offY=e.clientY-playerBox.offsetTop;
    handle.setPointerCapture(e.pointerId);
  });
  handle.addEventListener("pointermove",e=>{
    if(!drag)return;
    let x=e.clientX-offX,y=e.clientY-offY;
    x=Math.max(0,Math.min(window.innerWidth-playerBox.offsetWidth,x));
    y=Math.max(0,Math.min(window.innerHeight-playerBox.offsetHeight,y));
    playerBox.style.left=x+"px";
    playerBox.style.top=y+"px";
  });
  handle.addEventListener("pointerup",()=>{drag=false;});

  // ==== INVERTED WORLD (every 100th visit) ====
  let visits=parseInt(localStorage.getItem("comp_visits")||"0")+1;
  localStorage.setItem("comp_visits",visits);
  if(visits%100===0) document.body.classList.add("inverted");

  // ==== UNMUTE HINT ====
  const hint=document.getElementById("unmuteHint");
  setTimeout(()=>{hint.style.opacity=1;},2000);
  setTimeout(()=>{hint.style.opacity=0;},8000);
  </script>
</body>
</html>

